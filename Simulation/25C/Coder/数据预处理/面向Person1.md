# 数据预处理部分 —— 写作指南

> 本文档面向写作手Person1，帮助你理解数据预处理的工作内容，并指导论文相关章节的撰写。

---

## 一、数据概览

### 1.1 我们使用了哪些数据？

本次建模使用了 **5 个数据文件**，均来自题目附件：

| 文件名 | 中文说明 | 主要用途 |
|--------|----------|----------|
| `summerOly_medal_counts.csv` | 各国历届奖牌数 | **核心数据**，预测目标 |
| `summerOly_hosts.csv` | 历届奥运会主办城市 | 分析"东道主效应" |
| `summerOly_programs.csv` | 各届比赛项目数量 | 归一化奖牌数 |
| `summerOly_athletes.csv` | 运动员详细记录 | 分析各国优势项目 |
| `data_dictionary.csv` | 数据字典 | 字段含义说明 |

### 1.2 数据基本信息

- **时间跨度**：1896年（首届现代奥运会）至 2024年（巴黎奥运会）
- **奥运届数**：30届（不含因战争取消的1916、1940、1944年）
- **参赛国家/地区**：164个（含历史实体如苏联、东德等）

> **论文写作建议**：在"数据来源"章节说明数据来自官方附件，并简要列出数据表结构。

---

## 二、数据清洗

### 2.1 缺失值处理

我们对数据进行了缺失值检查，结果如下：

| 数据表 | 缺失值情况 |
|--------|-----------|
| 奖牌数据 | **无缺失** |
| 主办城市 | 无缺失 |
| 比赛项目 | 无缺失 |

> **说明**：原始奖牌数据只记录了**获得奖牌的国家**，因此不存在"某国某年奖牌数为空"的情况。未获奖的国家本就不在记录中。

### 2.2 历史实体处理

奥运历史上存在一些已解体或改名的国家/地区：

| 历史实体 | 存在时间 | 参赛届数 |
|----------|----------|----------|
| 苏联 (Soviet Union) | 1952-1988 | 9届 |
| 东德 (East Germany) | 1968-1988 | 5届 |
| 西德 (West Germany) | 1968-1988 | 5届 |
| 捷克斯洛伐克 (Czechoslovakia) | 1920-1992 | 16届 |
| 南斯拉夫 (Yugoslavia) | 1924-1988 | 14届 |

**我们的处理策略**：**保留原始记录**，不进行合并。

**原因**：
1. 历史表现是重要的预测信号
2. 简单合并会扭曲历史数据的统计特征
3. 预测模型可以学习到"继承国"与"前身国"之间的关系

> **论文写作建议**：在方法论中说明对历史实体的处理策略，强调"保留原始记录以保持数据真实性"。

### 2.3 特殊字符清理

原始数据中存在特殊空格字符（`\xa0`，非断行空格），我们统一替换为普通空格并去除首尾空白，确保字符串匹配正确。

---

## 三、数据合并

### 3.1 构建分析主表

我们以**奖牌数据**为核心，通过**左连接（Left Join）**合并其他维度信息：

```
奖牌数据（主表）
    ├── 合并 → 主办城市数据 → 添加"是否为东道主"标志
    └── 合并 → 比赛项目数据 → 添加"当届总项目数"
```

### 3.2 东道主标志字段

我们创建了 `is_host` 字段：
- 当该国是当届奥运会的东道主时，`is_host = 1`
- 否则 `is_host = 0`

**验证结果**：共识别出 **30条** 东道主记录，每届恰好1个东道主，数据正确。

### 3.3 为什么需要总项目数？

不同届次的奥运会**比赛项目数量差异很大**：
- 1896年雅典：仅 43 个项目
- 2024年巴黎：329 个项目

因此，我们添加 `total_events` 字段，用于后续计算**奖牌占比**（归一化指标）：

$$
\text{medal\_ratio} = \frac{\text{某国奖牌总数}}{\text{当届总项目数}}
$$

这个指标消除了不同届次项目数量差异的影响，使得跨年份比较更加公平。

---

## 四、特征工程

> **什么是特征工程？** 简单说，就是从原始数据中**提取或创造**对预测有帮助的新变量。好的特征能极大提升模型准确性。

### 4.1 滞后特征（Lag Features）

**核心思想**：用**过去的成绩**预测**未来的成绩**。

| 特征名 | 含义 | 公式 |
|--------|------|------|
| `total_lag1` | 上一届奥运会的总奖牌数 | $\text{lag}_1(i,t) = \text{Total}_{i,t-4}$ |
| `total_lag2` | 上两届奥运会的总奖牌数 | $\text{lag}_2(i,t) = \text{Total}_{i,t-8}$ |
| `gold_lag1` | 上一届奥运会的金牌数 | $\text{gold\_lag}_1(i,t) = \text{Gold}_{i,t-4}$ |

**符号说明**：
- $i$ 表示某个国家
- $t$ 表示当前奥运年份（如2028）
- $t-4$ 表示上一届（如2024），因为夏季奥运会每4年一届

**为什么滞后特征重要？**
1. **惯性效应**：体育强国往往持续强势
2. **政策周期**：体育投入的效果有4-8年滞后期
3. **预测基准**："与上届相同"本身就是不错的预测基线

**首次参赛国家的处理**：滞后值填充为 0，表示"无历史成绩"。

### 4.2 滚动平均特征

**核心思想**：单届成绩可能有偶然因素，用**多届平均**衡量稳定实力。

| 特征名 | 含义 | 公式 |
|--------|------|------|
| `total_rolling3_mean` | 过去3届的平均奖牌数 | $\bar{M}_3(i,t) = \frac{1}{3}\sum_{k=1}^{3} \text{Total}_{i,t-4k}$ |

**公式详解**：
$$
\bar{M}_3(i,t) = \frac{\text{Total}_{i,t-4} + \text{Total}_{i,t-8} + \text{Total}_{i,t-12}}{3}
$$

例如，预测中国2028年的奖牌数时：
$$
\bar{M}_3(\text{中国},2028) = \frac{\text{2024年奖牌数} + \text{2020年奖牌数} + \text{2016年奖牌数}}{3}
$$

**为什么选择3届？**
- 窗口太小（如2届）：平滑效果不足
- 窗口太大（如5届）：对近期变化不敏感
- 3届约12年，正好覆盖一个体育投入周期

### 4.3 其他衍生特征

| 特征名 | 含义 | 计算方式 |
|--------|------|----------|
| `participation_count` | 参赛届数 | 该国历史上参加奥运会的次数 |
| `gold_ratio` | 金牌占比 | $\frac{\text{金牌数}}{\text{总奖牌数}}$ |
| `total_change` | 奖牌变化量 | 当届奖牌数 - 上届奖牌数 |

### 4.4 特征与目标的相关性

我们计算了各特征与目标变量（Total奖牌数）的相关性：

| 特征 | 相关系数 | 重要程度 |
|------|----------|----------|
| total_rolling3_mean | 0.835 | ⭐⭐⭐⭐⭐ |
| total_lag1 | 0.800 | ⭐⭐⭐⭐⭐ |
| gold_lag1 | 0.791 | ⭐⭐⭐⭐⭐ |
| total_lag2 | 0.759 | ⭐⭐⭐⭐ |
| is_host | 0.368 | ⭐⭐⭐ |
| participation_count | 0.232 | ⭐⭐ |

> **结论**：历史表现（滞后特征和滚动平均）是最强的预测因子。

---

## 五、最终输出

### 5.1 输出文件

处理后的数据保存为 `processed_medal_data.csv`，包含 **1,435条记录、16个字段**。

### 5.2 特征字段说明表

| 字段名 | 中文说明 | 数据类型 | 来源 |
|--------|----------|----------|------|
| Year | 奥运年份 | 整数 | 原始数据 |
| NOC | 国家名称 | 文本 | 原始数据 |
| Gold | 金牌数 | 整数 | 原始数据 |
| Silver | 银牌数 | 整数 | 原始数据 |
| Bronze | 铜牌数 | 整数 | 原始数据 |
| Total | 总奖牌数 | 整数 | 原始数据（预测目标） |
| Rank | 当届排名 | 整数 | 原始数据 |
| is_host | 是否为东道主 | 0/1 | 合并生成 |
| total_events | 当届总项目数 | 整数 | 合并生成 |
| total_lag1 | 上届奖牌数 | 浮点数 | 特征工程 |
| total_lag2 | 上两届奖牌数 | 浮点数 | 特征工程 |
| gold_lag1 | 上届金牌数 | 浮点数 | 特征工程 |
| total_rolling3_mean | 近3届平均奖牌数 | 浮点数 | 特征工程 |
| total_change | 奖牌变化量 | 浮点数 | 特征工程 |
| participation_count | 参赛届数 | 整数 | 特征工程 |
| gold_ratio | 金牌占比 | 浮点数 | 特征工程 |

---

## 六、论文撰写建议
（AI给的，你自己看往年O奖论文怎么写的你就咋写，）
### 6.1 建议的章节结构

```
2. 数据预处理与特征工程
   2.1 数据来源与描述
       - 数据表介绍
       - 时间范围与样本量
   2.2 数据清洗
       - 缺失值处理
       - 历史实体处理策略
   2.3 数据整合
       - 多表合并方法
       - 东道主标志构建
   2.4 特征工程
       - 滞后特征
       - 滚动平均特征
       - 其他衍生特征
   2.5 特征相关性分析
```

### 6.2 关键公式（LaTeX格式）

**滞后特征**：
```latex
\text{lag}_1(i,t) = \text{Total}_{i,t-4}
```

**滚动平均**：
```latex
\bar{M}_3(i,t) = \frac{1}{3}\sum_{k=1}^{3} \text{Total}_{i,t-4k}
```

**奖牌占比**：
```latex
\text{medal\_ratio} = \frac{\text{Total}_i}{\text{TotalEvents}_t}
```

### 6.3 常用英文表达

- 数据预处理：Data Preprocessing
- 特征工程：Feature Engineering
- 滞后特征：Lag Features
- 滚动平均：Rolling Average / Moving Average
- 东道主效应：Host Country Effect / Home Advantage
- 缺失值：Missing Values
- 左连接：Left Join

---

## 七、总结

数据预处理阶段完成了以下工作：

1. ✅ 加载并理解5个原始数据文件
2. ✅ 清洗数据（处理特殊字符、保留历史实体）
3. ✅ 合并多表，添加东道主标志和总项目数
4. ✅ 创建滞后特征、滚动平均等预测性特征
5. ✅ 验证数据正确性
6. ✅ 输出干净的分析主表

**核心输出**：`processed_medal_data.csv`（1,435条记录，16个特征）

---

*如有疑问，请联系Coder讨论。*

